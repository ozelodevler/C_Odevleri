#include <stdio.h>
#include <conio.h>
#include <windows.h>
#include <time.h>
#include <stdlib.h>

int saha[80][23]= {0};

int ates_x[100]= {0};
int ates_y[100]= {0};

int bomba_x[10]= {0};
int bomba_y[10]= {0};
int batlama_x[10]= {0};
int batlama_y[10]= {0};



int kuyrukSutun[500];
int kuyrukSatir[500];
int maap[80][23]= {0};
int bomba_sayisi=5;
int ekran_yuksekligi=30;
int ekran_genisligi=120;
int do_sayac=0;
int score=0;



void gotoxy(short x, short y)
{
    HANDLE hConsoleOutput;
    COORD Cursor_Pos = {x-1, y-1};
    hConsoleOutput = GetStdHandle(STD_OUTPUT_HANDLE);
    SetConsoleCursorPosition(hConsoleOutput, Cursor_Pos);
}
void cerceve()
{
    for(int i=1; i<=30; i++)
    {
        gotoxy(1,i);
        printf("%c",179);
        gotoxy(120,i);
        printf("%c",179);
    }
    for(int i=2; i<120; i++)
    {
        gotoxy(i,30);
        printf("%c",196);
    }
    gotoxy(1,30);
    printf("%c",192);
    gotoxy(120,30);
    printf("%c",217);

}


void mermi_ve_bombe_yok_et(int bombanin_y,int bombanin_x,int merminin_y,int merminin_x)
{

    gotoxy(bomba_x[bombanin_x],bomba_y[bombanin_y]);
    printf(" ");
    gotoxy(bomba_x[bombanin_x]+2,bomba_y[bombanin_y]);
    printf(" ");
    gotoxy(bomba_x[bombanin_x]-2,bomba_y[bombanin_y]);
    printf(" ");
    gotoxy(bomba_x[bombanin_x]+1,bomba_y[bombanin_y]);
    printf(" ");
    gotoxy(bomba_x[bombanin_x]-1,bomba_y[bombanin_y]);
    printf(" ");
    bomba_y[bombanin_y]=0;
    bomba_x[bombanin_x]=0;
    gotoxy(ates_x[merminin_x],ates_y[merminin_y]);
    printf(" ");
    gotoxy(ates_x[merminin_x],ates_y[merminin_y]-1);
    printf(" ");
    gotoxy(ates_x[merminin_x],ates_y[merminin_y]-1);
    printf(" ");
    ates_x[merminin_x]=0;
    ates_y[merminin_y]=0;
    score++;

}




long int k=0;
randomAta()
{
    srand(time(NULL));
    srand(time(NULL));
    k=abs(4+rand()%90);
    while(k<=4)
    {
        k=abs(4+rand()%90);
    }
    for(int i=0; i<bomba_sayisi; i++)
    {
        if(bomba_x[i]==0&&bomba_y[i]==0)
        {
            bomba_x[i]=abs(k);
            bomba_y[i]=2;
            break;
        }
    }
}
void ates_et(int x)
{
    for(int i=0; i<100; i++)
    {
        if(ates_x[i]==0)
        {
            ates_x[i]=x;
            ates_y[i]=ekran_yuksekligi-1;
            break;
        }
    }
}

void main()
{
    randomAta();
    cerceve();
    int sx=60,sy;
    int dy=0,dx=0;
    unsigned char tus;
    int a=5;
    long int sayac=0;
    int devam=0;
    int bomba_uret_random=5;
    if(sayac%40000==0)
    {
        sayac=0;
    }
    do
    {
        if(kbhit())
        {
            tus=getch();
            if(tus==224)
            {
                tus=getch();
                switch(tus)
                {

                case 77:
                    dx=1;
                    dy=0;
                    break;
                case 75:
                    dx=-1;
                    dy=0;
                    break;
                case 72:
                    ates_et(sx);
                    break;
                }
            }
        }
        sx=sx+dx;
        sy=ekran_yuksekligi-1;
        if(sx>ekran_genisligi-4)
            sx=2;
        if(sx<2)
            sx=ekran_genisligi-4;
        kuyrukSutun[0]=sx;
        kuyrukSatir[0]=sy;
        int i;
        gotoxy(kuyrukSutun[0],kuyrukSatir[0]);
        printf("....");
        gotoxy(kuyrukSutun[0]+1,kuyrukSatir[0]-1);
        printf("..");
        if(sayac%bomba_uret_random==0)
        {
            k=10+rand()%100;
            bomba_uret_random=k;
            randomAta();
        }

        if(sayac%1000==0)
        {
            for(int bombalar=0; bombalar<bomba_sayisi; bombalar++)
            {
                if(bomba_x[bombalar]>0)
                {
                    bomba_y[bombalar]++;
                    if(bomba_y[bombalar]>=ekran_yuksekligi-1)
                    {
                        gotoxy(bomba_x[bombalar],bomba_y[bombalar]);
                        printf(" ");
                        gotoxy(bomba_x[bombalar]+2,bomba_y[bombalar]);
                        printf(" ");
                        gotoxy(bomba_x[bombalar]-2,bomba_y[bombalar]);
                        printf(" ");
                        gotoxy(bomba_x[bombalar]+1,bomba_y[bombalar]);
                        printf(" ");
                        gotoxy(bomba_x[bombalar]-1,bomba_y[bombalar]);
                        printf(" ");
                        bomba_y[bombalar]=0;
                        bomba_x[bombalar]=0;
                        score--;
                    }
                    else
                    {
                        gotoxy(bomba_x[bombalar],bomba_y[bombalar]);
                        printf(" ");
                        gotoxy(bomba_x[bombalar],bomba_y[bombalar]+1);
                        printf(" ");
                        gotoxy(bomba_x[bombalar],bomba_y[bombalar]-1);
                        printf(" ");
                        gotoxy(bomba_x[bombalar]+1,bomba_y[bombalar]-1);
                        printf(" ");
                        gotoxy(bomba_x[bombalar]-1,bomba_y[bombalar]-1);
                        printf(" ");
                        gotoxy(bomba_x[bombalar]+2,bomba_y[bombalar]-1);
                        printf(" ");
                        gotoxy(bomba_x[bombalar]-2,bomba_y[bombalar]);
                        printf(" ");
                        gotoxy(bomba_x[bombalar],bomba_y[bombalar]);
                        printf(" ");
                        gotoxy(bomba_x[bombalar]+1,bomba_y[bombalar]);
                        printf(" ");
                        gotoxy(bomba_x[bombalar]-1,bomba_y[bombalar]);
                        printf(" ");
                        gotoxy(bomba_x[bombalar]+2,bomba_y[bombalar]);
                        printf(" ");
                        gotoxy(bomba_x[bombalar]-2,bomba_y[bombalar]);
                        printf(" ");
                        gotoxy(bomba_x[bombalar],bomba_y[bombalar]+1);
                        printf("%c",95);
                        gotoxy(bomba_x[bombalar]-1,bomba_y[bombalar]+1);
                        printf("%c",45);
                        gotoxy(bomba_x[bombalar]+1,bomba_y[bombalar]+1);
                        printf("%c",45);
                        gotoxy(bomba_x[bombalar]-2,bomba_y[bombalar]+1);
                        printf("%c",40);
                        gotoxy(bomba_x[bombalar]+2,bomba_y[bombalar]+1);
                        printf("%c",41);
                    }
                }
            }
        }

    for(int bombalar_1=0; bombalar_1<bomba_sayisi; bombalar_1++)
    {
        if(bomba_x[bombalar_1]>0)
        {
            for(int mermi_up=0; mermi_up<100; mermi_up++)
            {
                if(ates_y[mermi_up]==bomba_y[bombalar_1]&&ates_x[mermi_up]==bomba_x[bombalar_1])
                {
                    mermi_ve_bombe_yok_et(bombalar_1,bombalar_1,mermi_up,mermi_up);
                }
            }
        }
        sayac++;
        if(sayac%1000==0){

               for( i=0; i<ekran_genisligi-4; i++)
        {
            if(ates_x[i]>0)
            {
                 gotoxy(ates_x[i],ates_y[i]);
                 printf(" ");
                 ates_y[i]--;
                 gotoxy(ates_x[i],ates_y[i]);
                 printf(".");
            }
            if(ates_y[i]==3)
            {
                gotoxy(ates_x[i],ates_y[i]);
                printf(" ");
                gotoxy(ates_x[i],ates_y[i]-1);
                printf(" ");
                gotoxy(ates_x[i],ates_y[i]-1);
                printf(" ");
                ates_x[i]=0;
                ates_y[i]=0;
            }
        }

        }

        for(i=0; i<=2; i++)
        {
            gotoxy(kuyrukSutun[i]+1,kuyrukSatir[i]);
            printf(" ");
            gotoxy(kuyrukSutun[i],kuyrukSatir[i]);
            printf(" ");
            gotoxy(kuyrukSutun[i]+2,kuyrukSatir[i]);
            printf(" ");
            gotoxy(kuyrukSutun[i]+3,kuyrukSatir[i]);
            printf(" ");
            gotoxy(kuyrukSutun[i]+1,kuyrukSatir[i]-1);
            printf(" ");
            gotoxy(kuyrukSutun[i]+2,kuyrukSatir[i]-1);
            printf(" ");
            gotoxy(kuyrukSutun[i]+3,kuyrukSatir[i]-1);
            printf(" ");
        }
        for(i=a; i>0; i--)
        {
            kuyrukSutun[i]=kuyrukSutun[i-1];
            kuyrukSatir[i]=kuyrukSatir[i-1];
        }
        gotoxy(1,1);
        printf("%d",score);


    }

    }
    while (devam==0);
}



